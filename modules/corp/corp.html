<div class="page-title">
    <a id="button-corp-create" href="javascript:void(0);"><i class="fa fa-plus"></i>新增企业</a>
    <a id="button-corp-update" href="javascript:void(0);"><i class="fa fa-pencil-square-o"></i>修改企业</a>
    <a id="button-corpcontract-create" href="javascript:void(0);"><i class="fa fa-pencil-square-o"></i>新增合同</a>
    <a id="button-brand-create" href="javascript:void(0);"><i class="fa fa-pencil-square-o"></i>新增品牌</a>
</div>
<div class="panel-box">    
    <div class="page-title">
        <form class="filter-search" style="width: 400px;">
            <input id="filter_corpname" type="text" placeholder="企业名称" style="width: 350px;">
            <i id="filter-corp-qrybtn" class="fa fa-search"></i>
        </form>
    </div>
    <div class="table-responsive">
        <table id="table-corp-sheet" class="table table-hover" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th></th>
                    <th>企业ID</th>
                    <th>企业名称</th>
                    <th>企业类型</th>
                    <th>工商注册号</th>
                    <th>状 态</th>
                    <th>企业联系人</th>
                    <th>企业联系电话</th>
                    <th>企业联系QQ</th>
                    <th>企业联系微信</th>
                    <th>公司销售</th>
                    <th>公司销售QQ</th>
                    <!--<th>地理位置</th>-->
                    <th>备注描述</th>
                    <th>创建时间</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>
<div id="dialog-corp-update" class="modal fade" tabindex="-1" data-width="1000" data-backdrop="static" data-keyboard="false" style="display: none;">
    <div class="modal-header"> 
        <button type="button" class="close" data-dismiss="modal" id="corpclose" aria-hidden="true">×</button>
        <h4 id="dtitle-corp-update" class="modal-title">修改企业</h4> 
    </div>
    <div class="modal-body" style="background: #fdf8e4">
        <form id="form-corp-update" class="m-t form-horizontal" role="form">
            <ul class="list-group">
                <li class="list-group-item"><span class=" panel panel-primary">企业信息</span>
                <div class="form-group">
                    <div class="col-lg-6">
                        <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>企业名称</label>
                        <div class="col-lg-8"><input id="companyName" name="corpname" placeholder="企业名称" class="form-control" maxlength="32"  required  data-error="企业名称不能为空"><div class="help-block with-errors"></div></div>
                    </div>
                    <div class="col-lg-6">
                            <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>类型</label>
                            <div class="col-lg-4">
                            <input type="radio" role="radio" id="company1" checked=true  name="type" value="2"><label for="company1" class="control-label">企业</label>
                            </div>
                            <div class="col-lg-4">
                                <input type="radio" role="radio" id="person1" name="type" value="4"><label for="person1"  class="control-label">个人</label>
                            </div>
                    </div>
                </div>
            <div class="form-group">
                <div class="col-lg-6">
                    <label class="col-lg-3 control-label">工商注册号</label>
                    <div class="col-lg-8"><input id="corpNum" name="corpno" placeholder="工商注册号" class="form-control" maxlength="128"  data-error="工商注册号不能为空"><div class="help-block with-errors"></div></div>
                </div>
                <div class="col-lg-6">
                    <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>状态</label>
                    <div class="col-lg-8">
                        <select id="selectCorpStatus" name="status" class="form-control">
                            <option value="10">正常</option>
                            <option value="20">待审批</option>
                            <option value="40">冻结</option>
                            <option value="50">隐藏</option>
                            <option value="60">关闭</option>
                            <option value="70">过期</option>
                            <option value="80">删除</option>
                        </select>
                    </div>
                </div>
            </div>
                <div class="form-group">
                    <div class="col-lg-6">
                        <label class="col-lg-3 control-label">所属行业</label>
                        <div class="col-lg-8"><input name="corpscopeid" placeholder="所属行业" class="form-control"></div>
                    </div>
                    <div class="col-lg-6">
                        <label class="col-lg-3 control-label">所在地址</label>
                        <div class="col-lg-8"><input name="locaddress" placeholder="所在地址" class="form-control"></div>
                    </div>
                </div>
                </li>
                </ul>
            <ul class="list-group">
                <li class="list-group-item"><span class=" panel panel-success">各项资费单价</span>
                <div class="form-group">
                    <div class="col-lg-4">
                        <label class="col-lg-5 control-label">语音单价(分)</label>
                        <div class="col-lg-7"><input name="platevoiceprice" placeholder="语音单价" class="form-control moneyc"  data-error="请输入语音单价">
                        </div>
                        <div class="help-block with-errors"></div>
                    </div>
                    <div class="col-lg-4">
                        <label class="col-lg-5 control-label">短信单价(分)</label>
                        <div class="col-lg-7"><input name="platenoteprice" placeholder="短信单价" class="form-control moneyc" data-error="请输入短信单价"></div>
                        <div class="help-block with-errors"></div>
                    </div>
                    <div class="col-lg-4">
                        <label class="col-lg-5 control-label">流量单价(分)</label>
                        <div class="col-lg-7"><input name="plateflowprice" placeholder="流量单价" class="form-control moneyc" data-error="请输入流量单价">
                        </div><div class="help-block with-errors"></div>
                    </div>
                </div>
                    </li>
                </ul>

            <ul class="list-group">
                <li class="list-group-item"><span class=" panel panel-info">企业联系人信息</span>
                <div class="form-group">
                    <input name="corpid" type="hidden">
                    <div class="col-lg-6">
                        <label class="col-lg-3 control-label">联系人</label>
                        <div class="col-lg-8"><input name="linkman" placeholder="联系人" class="form-control"></div>
                    </div>
                    <div class="col-lg-6">
                        <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>联系电话</label>
                        <div class="col-lg-8"><input name="linktel" type="tel" placeholder="联系电话" class="form-control" pattern="^\d{8,13}$" data-error="请输入正确的联系电话"><div class="help-block with-errors"></div></div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-lg-6">
                        <label class="col-lg-3 control-label">联系微信</label>
                        <div class="col-lg-8"><input name="linkwx" placeholder="联系微信" class="form-control"></div>
                    </div>
                    <div class="col-lg-6">
                        <label class="col-lg-3 control-label">联系QQ</label>
                        <div class="col-lg-8"><input name="linkqq" type="tel" placeholder="联系QQ" class="form-control" pattern="^[1-9]\d{4,12}$" data-error="请输入正确的QQ号码"><div class="help-block with-errors"></div></div>
                    </div>
                </div>
            </li>
                </ul>
            <ul class="list-group">
                <li class="list-group-item"><span class=" panel panel-danger">公司商务对接信息</span>
                <div class="form-group">
                    <div class="col-lg-6">
                        <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>销售对接人</label>
                        <div class="col-lg-8"><input name="busman" placeholder="销售对接人姓名" class="form-control"></div>
                    </div>
                    <div class="col-lg-6">
                        <label class="col-lg-3 control-label">销售人QQ</label>
                      <div class="col-lg-8"><input name="busqq" placeholder="销售对接人QQ" class="form-control"></div>
                    </div>
                </div>
                <!--<div class="form-group">
                    <div class="col-lg-6">
                        <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>项目对接人</label>
                        <div class="col-lg-8"><input name="busman" placeholder="项目对接人" class="form-control"></div>
                    </div>
                    <div class="col-lg-6">
                        <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>项目人QQ</label>
                        <div class="col-lg-8"><input name="busqq" placeholder="项目对接人QQ" class="form-control"></div>
                    </div>
                </div>-->
                <div class="form-group">
                    <label class="col-lg-2 control-label">备注说明</label>
                    <div class="col-lg-8"><textarea name="remark" id="corpremark" placeholder="备注说明" style="height: 8rem;" class="form-control"></textarea></div>
                </div>
                </li>
                </ul>
            <br>
            <button id="formbtn-corp-update" type="button" class="btn btn-theme btn-lg btn-block ">提 交</button><br>
        </form>
    </div>
    <div id="tips-corp-update" class="module-alert-tips"></div><br>
</div>
<!--新增合同模态框-->
<div id="dialog-corpcontract-update" class="modal fade" tabindex="-1" data-width="650" data-backdrop="static" data-keyboard="false" style="display: none;">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" id="contractclose">×</button>
        <h4 id="dtitle-corpcontract-update" class="modal-title">修改企业</h4>
    </div>
    <div class="modal-body">
        <form id="form-corpcontract-update" class="m-t form-horizontal" role="form">
            <input id="corphidden" name="corpid" type="hidden">
            <input id="imgname" name="contractimg" type="hidden">
            <div class="form-group">
                <div class="col-lg-8">
                    <div class="form-group">
                        <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>企业名称</label>
                        <div class="col-lg-9"><input  name="corpname" id="companyId" placeholder="企业名称" class="form-control" maxlength="32"  required  data-error="企业名称不能为空"><div class="help-block with-errors"></div></div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>合同编号</label>
                        <div class="col-lg-9"><input name="contractno" placeholder="合同编号" class="form-control" required></div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>签订日期</label>
                        <div class="col-lg-9"><input name="contractstartday" type="date" placeholder="格式例:20170101" class="form-control  datetimepicker" required data-error="请输入合同签订日期"><div class="help-block with-errors"></div></div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>有效日期</label>
                        <div class="col-lg-9"><input name="contractendday" type="date" placeholder="格式例:20170101" class="form-control" required data-error="请输入合同有效日期"><div class="help-block with-errors"></div></div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>合同金额</label>
                        <div class="col-lg-9"><input name="contractmoney" type="tel" placeholder="合同金额" class="form-control" required  data-error="请输入正确的合同金额" style="width: 240px;display: inline-block;
                        "><label>元</label><div class="help-block with-errors"></div></div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class=" col-lg-12"><label class="col-lg-12 control-label" style="padding-right: 30px;">上传合同快照图片</label></div>
                    <div class="form-group col-lg-12" style="height: 200px;width: 180px"><img id="contractimg" src="" style="width: 150px;height: 200px; display: block"></div>
                    <div class="btn btn-success fileinput-button" style="margin-left: 20px;">
                        <i class="fa fa-fw fa-upload"></i>
                        <span>上传图片</span>
                        <input id="fileupload-goods-btn" type="file" name="file">
                    </div>
                </div>
                <br>
                <div class="col-lg-12">
                    <button id="formbtn-corpcontract-update" type="button" class="btn btn-theme btn-lg btn-block ">提 交</button><br>
                </div>
            </div>
        </form>
    </div>
    <div id="tips-corpcontract-update" class="module-alert-tips"></div><br>
</div>
<!--合同模态框结束-->
<!--新增品牌------->
<div id="dialog-brand-update" class="modal fade" tabindex="-1" data-width="850" data-backdrop="static" data-keyboard="false" style="display: none;">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" id="brandclose">×</button>
        <h4 id="dtitle-brand-update" class="modal-title">修改品牌</h4>
    </div>
    <div class="modal-body" style="background: #fdf8e4">
        <form id="form-brand-update" class="m-t form-horizontal" role="form">
            <input  name="brandid" type="hidden" id="brand">
            <input  name="corpid" type="hidden" id="qiyeId">
            <ul class="list-group">
                <li class="list-group-item"><span class=" panel panel-primary">企业信息</span>
                    <div class="form-group">
                        <div class="col-lg-6">
                            <label class="col-lg-3 control-label">
                                <span style="color: red;">*&nbsp;</span>企业名称</label>
                            <div class="col-lg-8"><input id="brandcompanyid"  placeholder="企业名称" class="form-control" maxlength="32"  required  data-error="企业名称不能为空"><div class="help-block with-errors"></div></div>
                        </div>
                        <div class="col-lg-6">
                            <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>状态</label>
                            <div class="col-lg-8">
                                <select id="selectBrandStatus" name="status" class="form-control">
                                    <option value="10">正常</option>
                                    <option value="20">待审批</option>
                                    <option value="40">冻结</option>
                                    <option value="50">隐藏</option>
                                    <option value="60">关闭</option>
                                    <option value="70">过期</option>
                                    <option value="80">删除</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
            <ul class="list-group">
                <li class="list-group-item"><span class=" panel panel-primary">品牌信息</span>
                    <div class="form-group">
                        <div class="col-lg-4">
                            <label class="col-lg-5 control-label"><span style="color: red;">*&nbsp;</span>品牌名称</label>
                            <div class="col-lg-7"><input  name="brandname" placeholder="必填" class="form-control" maxlength="32"  required  data-error="品牌名称不能为空"><div class="help-block with-errors"></div></div>
                        </div>
                        <div class="col-lg-4">
                            <label class="col-lg-5 control-label"><span style="color: red;">*&nbsp;</span>品牌ID</label>
                            <div class="col-lg-7"><input id="brandno"  name="brandno" placeholder="与旧系统一致" class="form-control" maxlength="8"><div class="help-block with-errors"></div></div>
                        </div>
                        <div class="col-lg-4">
                            <label class="col-lg-5 control-label">版本号</label>
                            <div class="col-lg-7"><input name="old_oemver" type="tel" placeholder="旧版OEM版本号" class="form-control" data-error="请输入正确的联系电话"><div class="help-block with-errors"></div></div>
                        </div>
                    </div>
                </li>
            </ul>
            <ul class="list-group">
                <li class="list-group-item"><span class=" panel panel-primary">资费信息</span>
                    <div class="form-group">
                        <div class="col-lg-4">
                            <label class="col-lg-6 control-label">语音单价(分)</label>
                            <div class="col-lg-5"><input name="voiceprice" class="form-control moneyb"  data-error="请输入语音单价"><div class="help-block with-errors"></div></div>
                        </div>
                        <div class="col-lg-4">
                            <label class="col-lg-6 control-label">短信单价(分)</label>
                            <div class="col-lg-5"><input name="noteprice" class="form-control moneyb"  data-error="请输入短信单价" ><div class="help-block with-errors"></div></div>
                        </div>
                        <div class="col-lg-4">
                            <label class="col-lg-6 control-label">流量单价(分)</label>
                            <div class="col-lg-5"><input name="flowprice" class="form-control moneyb"  data-error="请输入流量单价"><div class="help-block with-errors"></div></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-4">
                            <label class="col-lg-6 control-label">直拨资费(分)</label>
                            <div class="col-lg-5"><input name="directpirce" class="form-control moneyb"  data-error="请输入直拨资费"><div class="help-block with-errors"></div></div>
                        </div>
                        <div class="col-lg-4">
                            <label class="col-lg-6 control-label">回拨资费(分)</label>
                            <div class="col-lg-5"><input name="backprice" class="form-control moneyb"  data-error="请输入回拨资费"><div class="help-block with-errors"></div></div>
                        </div>
                        <div class="col-lg-4">
                            <label class="col-lg-6 control-label">回拨专线名称</label>
                            <div class="col-lg-5"><input name="backline" class="form-control" data-error="请输入回拨专线名称"><div class="help-block with-errors"></div></div>
                        </div>

                    </div>
                </li>
            </ul>
            <ul class="list-group">
                <li class="list-group-item"><span class=" panel panel-primary">企业联系信息</span>
                    <div class="form-group">
                        <div class="col-lg-6">
                            <label class="col-lg-4 control-label">企业联系人</label>
                            <div class="col-lg-8"><input name="linkman" id="linkman" placeholder="联系人姓名" class="form-control" data-error="请输入回拨专线名称"><div class="help-block with-errors"></div></div>
                        </div>
                        <div class="col-lg-6">
                            <label class="col-lg-4 control-label"><span style="color: red;">*&nbsp;</span>企业联系电话</label>
                            <div class="col-lg-8"><input name="linktel" id="tellink" type="tel" placeholder="企业联系电话" class="form-control" data-error="请输入正确的联系电话"><div class="help-block with-errors"></div></div>
                        </div>
                        <div class="col-lg-6">
                            <label class="col-lg-4 control-label">联系QQ</label>
                            <div class="col-lg-8"><input name="linkqq" id="qqlink" placeholder="联系人QQ" class="form-control" data-error="请输入正确的QQ号码"><div class="help-block with-errors"></div></div>
                        </div>
                    </div>
                </li>
            </ul>
            <ul class="list-group">
                <li class="list-group-item"><span class=" panel panel-primary">公司对接信息</span>
                    <div class="form-group">
                        <div class="col-lg-6">
                            <label class="col-lg-4 control-label"><span style="color: red;">*&nbsp;</span>项目对接人</label>
                            <div class="col-lg-8"><input name="busman" type="tel" id="busman" placeholder="公司项目对接人" class="form-control" data-error="请输入正确的联系电话"><div class="help-block with-errors"></div></div>
                        </div>
                        <div class="col-lg-6">
                            <label class="col-lg-4 control-label">项目人QQ</label>
                            <div class="col-lg-8"><input name="busqq" id="busqq" placeholder="项目对接人QQ" class="form-control" data-error="请输入回拨专线名称"><div class="help-block with-errors"></div></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-12">
                            <label class="col-lg-2 control-label">备注说明</label>
                            <div class="col-lg-9"><textarea name="remark" placeholder="备注说明" style="height: 8rem;" class="form-control"></textarea></div>
                        </div>
                    </div>
                </li>
            </ul>
            <br>
            <button id="formbtn-brand-update" type="button" class="btn btn-theme btn-lg btn-block ">提 交</button><br>
        </form>
    </div>
    <div id="tips-brand-update" class="module-alert-tips"></div><br>
</div>
<!--结束-->
<div id="dialog-brand-got" class="modal fade" tabindex="-1" data-width="550" data-backdrop="static" data-keyboard="false" style="display: none;">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4>品牌ID已存在,请重新填写</h4>
    </div>
</div>
<script>
    {
        if (system_memberinfo && system_memberinfo.memberid) {
            defCorpTypeRender = function (value, type, full) {
                if (value == 2) return "企业";
                if (value == 4) return "个人";
                return "未知";
            };
            var mtable = $('#table-corp-sheet').dataTable({
                ajax: {
                    url: "/pipes/corp/query",
                    data: function (f) {
                        f.bean = JSON.stringify({
                            corpname: $('#filter_corpname').val().trim()
                        });
                        f.sort = 'createtime';
                        f.order = 'DESC';
                    },
                },
                columnDefs: [{
                        className: 'select-checkbox',
                        targets: 0
                    }],
                columns: [
                    {"data": "", render: $.defrender},
                    {"data": "corp36id", render: $.defrender},
                    {"data": "corpname", render: $.defrender},
                    {"data":"type", render:defCorpTypeRender},
                    {"data":"corpno",render:$.defrender},
                    {"data": "status", render: defStatusRender},
                    {"data": "linkman", render: $.defrender},
                    {"data": "linktel", render: $.defrender},
                    {"data": "linkqq", render: $.defrender},
                    {"data": "linkwx", render:$.defrender},
                    {"data": "busman", render:$.defrender},
                    {"data": "busqq", render:$.defrender},
//                    {"data": "locaddress", render: $.defrender},
                    {"data": "remark", render: $.defrender},
                    {"data": "createtime", render: Date.DateFormatter}
                ]
            });
            $('#filter-corp-qrybtn').bind("click", function () {
                mtable.api(true).draw(false);
                $('#table-corp-sheet').dataTable().fnPageChange(0);
            });
            //--------------------------- 初始化新增修改企业 -----------------------------
            $('#button-corp-create').bind("click", function () {
                $('#form-gfield-password').show();
                $('#dtitle-corp-update').html("新增企业");
                $("#tips-corp-update").html('');
                $("#form-corp-update").form('reset');
                $('#dialog-corp-update').modal('show');
                $("#corpNum").removeAttr("readonly", "readonly");
                $("#companyName").removeAttr("readonly", "readonly");
            /*    $("#form-corp-update").data('bootstrapValidator').destroy();
                $('#form-corp-update').data('bootstrapValidator', null);*/
                corpValidator();
            });
            $('#button-corp-update').bind("click", function () {
                var data = mtable.api(true).row({selected: true}).data();
                if (!data || !data.corpid) {
                    alert("请选择一条记录！");
                    return;
                }
              /*  $('#form-gfield-password').hide();*/
                $('#dtitle-corp-update').html("修改企业");
                $("#tips-corp-update").html('');
                $("#form-corp-update").form('reset');
                $("#form-corp-update").form('load', data);
                $('#dialog-corp-update').modal('show');
               /* $("#corpNum").attr("readonly", "readonly");*/
                $("#companyName").attr("readonly", "readonly");
                var markcontent=$("#corpremark").val();
                markcontent=markcontent.replace(/<br>/g,"");
                $("#corpremark").val(markcontent);
          /*      $("#form-corp-update").data('bootstrapValidator').destroy();
                $('#form-corp-update').data('bootstrapValidator', null);*/
                corpValidator();
            });
            //------------------------ 新增&修改企业提交 -----------------------------
            $('#formbtn-corp-update').bind("click", function (e) {
                var form = $("#form-corp-update");
                var json = form.serializeJson();
                var content=json.remark;
                content=content.replace(/<br>/g,' ');
                content=content.replace(/\n/g,'<br>');
               json.remark=content;
                $('#form-corp-update').bootstrapValidator('validate');
                if($('#form-corp-update').data('bootstrapValidator').isValid()) {
                    $.ajax({
                        cache: false,
                        dataType: "json",
                        type: "POST",
                        url: '/pipes/corp/update',
                        data: {
                            "bean": $.objectToString(json),
                        },
                        error: function () {//请求失败处理函数
                            alert('请求失败');
                        },
                        success: function (data) {
                            if (data && data.retcode && data.retcode > 0) {
                                alert(data.retinfo);
                            } else {
                                alert("保存成功");
                                $("#form-corp-update").data('bootstrapValidator').destroy();
                                $('#form-corp-update').data('bootstrapValidator', null);
                                $("#dialog-corp-update").modal('hide');
                                mtable.api(true).draw(false);
                            }
                        }
                    });
                }else{
                    alert("验证不通过,请按要求填写信息")
                }
            });
            //-----------------点击关闭摧毁验证---------------------------
           $("#corpclose").on("click",function(){
                $("#form-corp-update").data('bootstrapValidator').destroy();
                $('#form-corp-update').data('bootstrapValidator', null);
            });
            $("#contractclose").on("click",function(){
                $("#form-corpcontract-update").data('bootstrapValidator').destroy();
                $('#form-corpcontract-update').data('bootstrapValidator', null);
            });
            $("#brandclose").on("click",function(){
                $("#form-brand-update").data('bootstrapValidator').destroy();
                $('#form-brand-update').data('bootstrapValidator', null);
            });
            //-----------------验证企业表单方法------------------------------
            function corpValidator() {
                $('#form-corp-update').bootstrapValidator({
                    message: 'This value is not valid',
                    feedbackIcons: {
                        /*输入框不同状态，显示图片的样式*/
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {
                        /*验证*/
                        corpname: {
                            /*键名和input name值对应*/
                            message: 'The corpname is not valid',
                            validators: {
                                notEmpty: {
                                    /*非空提示*/
                                    message: '企业名称不能为空'
                                },
                                regexp: {
                                    /* 只需加此键值对 */
                                    regexp: /^[A-Za-z0-9\u4e00-\u9fa5]+$/,
                                    message: '企业名称不能包含任何数字或者符号'
                                }
                            }
                        },
                        corpno: {
                            message: '',
                            validators: {
                                regexp: {
                                    regexp: /^\d{13,24}$/,
                                    message: '工商注册号只能由数字组成，08年前旧版为13位，新版15位，三证合一版为24位'
                                }
                            }
                        },
                        platevoiceprice: {
                            message: "",
                            validators: {
                                regexp: {
                                    regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                                    message: '语音单价只能是大于等于0的数字'
                                }
                            }
                        },
                        platenoteprice: {
                            message: "",
                            validators: {
                                regexp: {
                                    regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                                    message: '短信单价只能是大于等于0的数字'
                                }
                            }
                        },
                        plateflowprice: {
                            message: "",
                            validators: {
                                regexp: {
                                    regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                                    message: '短信单价只能是大于等于0的数字'
                                }
                            }
                        }
                    }
                });
            }
            //-----------------新增合同-----------------------------------
            $('#button-corpcontract-create').bind("click", function () {
                var data = mtable.api(true).row({selected: true}).data();
                if (!data || !data.corpid) {
                    alert("请选择一条记录！");
                    return;
                }
                $('#dtitle-corpcontract-update').html("新增合同");
                $("#tips-corpcontract-update").html('');
                $("#form-corpcontract-update").form('reset');
                $("#companyId").val(data.corpname);
                $("#corphidden").val(data.corpid);
                $("#companyId").attr("readonly","readonly");
                contractValidator();
                $('#dialog-corpcontract-update').modal('show');
            });
            //---------------点击提交按钮保存新增合同信息------------------------
            $("#formbtn-corpcontract-update").on("click",function(e){
                var form=$("#form-corpcontract-update");
                var json = form.serializeJson();
                function time(time){
                    var arr=time.split("-");
                    var num="";
                    for(var i=0;i<arr.length;i++){
                        num+=arr[i];
                    }
                    Number(num);
                    time=num;
                    return time;
                }
                json.contractmoney=(json.contractmoney*100);
                json.contractstartday=time(json.contractstartday);
                json.contractendday=time(json.contractendday);
                $('#form-corpcontract-update').bootstrapValidator('validate');
                if($('#form-corpcontract-update').data('bootstrapValidator').isValid()) {
                    $.ajax({
                        cache: false,
                        dataType: "json",
                        type: "POST",
                        url: '/pipes/corpcontract/create',
                        data: {
                            "bean": $.objectToString(json),
                        },
                        error: function () {//请求失败处理函数
                            alert('请求失败');
                        },
                        success: function (data) {
                            if (data && data.retcode && data.retcode > 0) {
                                alert(data.retinfo);
                            } else {
                                document.getElementById('contractimg').src="";
                                if(confirm("保存成功!是否继续添加合同？")){
                                    var data = mtable.api(true).row({selected: true}).data();
                                    $("#form-corpcontract-update").form('reset');
                                    $("#form-corpcontract-update").data('bootstrapValidator').destroy();
                                    $('#form-corpcontract-update').data('bootstrapValidator', null);
                                    contractValidator();
                                    $("#companyId").val(data.corpname);
                                    $("#corphidden").val(data.corpid);
                                }else{
                                    $("#dialog-corpcontract-update").modal('hide');
                                    $("#form-corpcontract-update").data('bootstrapValidator').destroy();
                                    $('#form-corpcontract-update').data('bootstrapValidator', null);
                                }
                            }
                        }
                    });
                }else{
                    alert("验证失败，请按要求重新输入");
                }
            });
            //-----------------验证合同表单方法-------------------------------
            function contractValidator() {
                $('#form-corpcontract-update').bootstrapValidator({
                    message: 'This value is not valid',
                    feedbackIcons: {/*输入框不同状态，显示图片的样式*/
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {/*验证*/
                        contractno: {/*键名和input name值对应*/
                            message: 'The contractno is not valid',
                            validators: {
                                notEmpty: {/*非空提示*/
                                    message: '合同编号不能为空'
                                },
                                regexp: { /* 只需加此键值对 */
                                    regexp: /^[a-z-A-Z-0-9-]+$/,
                                    message: '合同编号只能由字母数字和短横线组成'
                                }
                            }
                        },
                        contractmoney:{
                            message: 'The contractmoney is not valid',
                            validators: {
                                notEmpty: {/*非空提示*/
                                    message: '合同金额不能为空'
                                },
                                regexp: { /* 只需加此键值对 */
                                    regexp: /^\d+$/,
                                    message: '合同金额只能用数字表示'
                                }
                            }
                        }
                    }
                });
            }
            //----------------新增品牌---------------------------------------
            $('#button-brand-create').bind("click", function () {
                var data = mtable.api(true).row({selected: true}).data();
                if (!data || !data.corpid) {
                    alert("请选择一条记录！");
                    return;
                }
                $('#form-gfield-password').show();
                $('#dtitle-brand-update').html("新增品牌");
                $("#tips-brand-update").html('');
                $("#form-brand-update").form('reset');
                $('#dialog-brand-update').modal('show');
                $("#brandcompanyid").val(data.corpname);
                $("#tellink").val(data.linktel);
                $("#qqlink").val(data.linkqq);
                $("#qiyeId").val(data.corpid);
                $("#linkman").val(data.linkman);
                $("#busman").val(data.busman);
                $("#busqq").val(data.busqq);
                $("#brandcompanyid").attr("readonly","readonly");
                brandValidator();
            });
            //----------------点击提交保存新增品牌信息--------------------------
            $('#formbtn-brand-update').bind("click", function (e) {
                var form = $("#form-brand-update");
                var json = form.serializeJson();
                var content=json.remark;
                content=content.replace(/<br>/g,' ');
                content=content.replace(/\n/g,'<br>');
                $('#form-brand-update').bootstrapValidator('validate');
                if( $('#form-brand-update').data('bootstrapValidator').isValid()) {
                    $.ajax({
                        cache: false,
                        dataType: "json",
                        type: "POST",
                        url: '/pipes/brand/update',
                        data: {
                            "bean": $.objectToString(json),
                        },
                        error: function () {//请求失败处理函数
                            alert('请求失败');
                        },
                        success: function (data) {
                            if (data && data.retcode && data.retcode > 0) {
                                /*alert(data.retinfo);*/
                                $("#dialog-brand-got").modal('show');
                            } else {
                                if(confirm("保存成功!是否继续添加品牌?")){
                                    var data = mtable.api(true).row({selected: true}).data();
                                    $("#form-brand-update").form('reset');
                                    $("#brandcompanyid").val(data.corpname);
                                    $("#tellink").val(data.linktel);
                                    $("#qqlink").val(data.linkqq);
                                    $("#qiyeId").val(data.corpid);
                                    $("#linkman").val(data.linkman);
                                    $("#busman").val(data.busman);
                                    $("#busqq").val(data.busqq);
                                    $("#form-brand-update").data('bootstrapValidator').destroy();
                                    $('#form-brand-update').data('bootstrapValidator', null);
                                    brandValidator();
                                }else{
                                    $("#dialog-brand-update").modal('hide');
                                    $("#form-brand-update").data('bootstrapValidator').destroy();
                                    $('#form-brand-update').data('bootstrapValidator', null);
                                }
                            }
                        }
                    });
                }else{
                    alert("验证失败,请根据要求填写信息")
                }
            });
            //----------------品牌表单校验-----------------------------------
            function brandValidator() {
                $('#form-brand-update').bootstrapValidator({
                    message: 'This value is not valid',
                    feedbackIcons: {/*输入框不同状态，显示图片的样式*/
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {/*验证*/
                        brandname: {/*键名和input name值对应*/
                            message: 'The corpname is not valid',
                            validators: {
                                notEmpty: {/*非空提示*/
                                    message: '品牌名称不能为空'
                                },
                                regexp: { /* 只需加此键值对 */
                                    regexp: /^[A-Za-z0-9\u4e00-\u9fa5]+$/,
                                    message: '品牌名称不能包含符号'
                                }
                            }
                        },
                        brandno: {
                            message:'',
                            validators: {
                                notEmpty: {/*非空提示*/
                                    message: '品牌ID不能为空'
                                },
                                regexp: {
                                    regexp: /^[a-zA-Z0-9]+\w*$/,
                                    message: '品牌ID只能由字母或数字开头，可包含字母，数字和下划线'
                                }
                            }
                        },
                        voiceprice: {
                            message:"",
                            validators: {
                                regexp: {
                                    regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                                    message: '语音单价只能是大于等于0的数字'
                                }
                            }
                        },
                        noteprice: {
                            message:"",
                            validators: {
                                regexp: {
                                    regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                                    message: '短信单价只能是大于等于0的数字'
                                }
                            }
                        },
                        flowprice: {
                            message:"",
                            validators: {
                                regexp: {
                                    regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                                    message: '流量单价只能是大于等于0的数字'
                                }
                            }
                        },
                        directprice: {
                            message:"",
                            validators: {
                                regexp: {
                                    regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                                    message: '直播资费只能是大于等于0的数字'
                                }
                            }
                        },
                        backprice: {
                            message:"",
                            validators: {
                                regexp: {
                                    regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                                    message: '回拨资费只能是大于等于0的数字'
                                }
                            }
                        }
                    }
                });
            }
            //----------------文本域enter事件--------------------------------

       /*     $("#corpremark").keyup(function(){
                if(event.keyCode == 13){
                    var content=$("#corpremark").val();
                    content=content.replace('\n','<br/>');
                   $("#corpremark").val(content);
                }
            });*/
        }
        //---------------上传图片到服务器-----------------------
        $('#fileupload-goods-btn').fileupload({
            type: 'POST',
            url: '/pipes/ueditor?action=uploadimage_contracts',
            done: function (e, data) {//设置文件上传完毕事件的回调函数
                var json = JSON.parse(data.result);
                /*  $('#fileupload-goods-btn').val(json.fileid);*/
                console.log(json.fileid);
                $("#contractimg").show();
                $("#imgname").val(json.fileid);
                document.getElementById('contractimg').src = '/dir/contracts/' + json.fileid;

            }
        });
        //-----------------------------------------------------------------

    }
</script>
<!--企业信息校验-->
<!--<script>
    $(document).ready(function() {
        $('#form-corp-update').bootstrapValidator({
            message: 'This value is not valid',
            feedbackIcons: {/*输入框不同状态，显示图片的样式*/
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {/*验证*/
                corpname: {/*键名和input name值对应*/
                    message: 'The corpname is not valid',
                    validators: {
                        notEmpty: {/*非空提示*/
                            message: '企业名称不能为空'
                        },
                        regexp: {/* 只需加此键值对 */
                            regexp: /^[A-Za-z0-9\u4e00-\u9fa5]+$/,
                            message: '企业名称不能包含任何数字或者符号'
                        }
                    }
                },
                corpno: {
                    message:'',
                    validators: {
                        regexp: {
                            regexp: /^\d{13,24}$/,
                            message: '工商注册号只能由数字组成，08年前旧版为13位，新版15位，三证合一版为24位'
                        }
                    }
                },
                platevoiceprice: {
                    message:"",
                    validators: {
                        regexp: {
                            regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                            message: '语音单价只能是大于等于0的数字'
                        }
                    }
                },
                platenoteprice: {
                    message:"",
                    validators: {
                        regexp: {
                            regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                            message: '短信单价只能是大于等于0的数字'
                        }
                    }
                },
                plateflowprice: {
                    message:"",
                    validators: {
                        regexp: {
                            regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                            message: '短信单价只能是大于等于0的数字'
                        }
                    }
                }
            }
        });
    });

</script>
&lt;!&ndash;合同信息校验&ndash;&gt;
<script>
    $(document).ready(function() {
        $('#form-corpcontract-update').bootstrapValidator({
            message: 'This value is not valid',
            feedbackIcons: {/*输入框不同状态，显示图片的样式*/
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {/*验证*/
                contractno: {/*键名和input name值对应*/
                    message: 'The contractno is not valid',
                    validators: {
                        notEmpty: {/*非空提示*/
                            message: '合同编号不能为空'
                        },
                        regexp: { /* 只需加此键值对 */
                            regexp: /^[a-z-0-9-]+$/,
                            message: '合同编号只能由字母数字和短横线组成'
                        }
                    }
                },
                contractmoney:{
                    message: 'The contractmoney is not valid',
                    validators: {
                        notEmpty: {/*非空提示*/
                            message: '合同金额不能为空'
                        },
                        regexp: { /* 只需加此键值对 */
                            regexp: /^\d+$/,
                            message: '合同金额只能用数字表示'
                        }
                    }
                }
            }
        });
    });

</script>
&lt;!&ndash;品牌信息校验&ndash;&gt;
<script>
    $(document).ready(function() {
        $('#form-brand-update').bootstrapValidator({
            message: 'This value is not valid',
            feedbackIcons: {/*输入框不同状态，显示图片的样式*/
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {/*验证*/
                brandname: {/*键名和input name值对应*/
                    message: 'The corpname is not valid',
                    validators: {
                        notEmpty: {/*非空提示*/
                            message: '品牌名称不能为空'
                        },
                        regexp: { /* 只需加此键值对 */
                            regexp: /^[A-Za-z0-9\u4e00-\u9fa5]+$/,
                            message: '品牌名称不能包含符号'
                        }
                    }
                },
                brandno: {
                    message:'',
                    validators: {
                        notEmpty: {/*非空提示*/
                            message: '品牌ID不能为空'
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9]+\w*$/,
                            message: '品牌ID只能由字母或数字开头，可包含字母，数字和下划线'
                        }
                    }
                },
                voiceprice: {
                    message:"",
                    validators: {
                        regexp: {
                            regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                            message: '语音单价只能是大于等于0的数字'
                        }
                    }
                },
                noteprice: {
                    message:"",
                    validators: {
                        regexp: {
                            regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                            message: '短信单价只能是大于等于0的数字'
                        }
                    }
                },
                flowprice: {
                    message:"",
                    validators: {
                        regexp: {
                            regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                            message: '流量单价只能是大于等于0的数字'
                        }
                    }
                },
                directprice: {
                    message:"",
                    validators: {
                        regexp: {
                            regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                            message: '直播资费只能是大于等于0的数字'
                        }
                    }
                },
                backprice: {
                    message:"",
                    validators: {
                        regexp: {
                            regexp: /^(\d|[1-9]\d+)(\.\d+)?$/,
                            message: '回拨资费只能是大于等于0的数字'
                        }
                    }
                }
            }
        });
    });

</script>-->
