<div class="panel-box">    
    <div class="page-title">
        <form class="filter-search" style="width: 400px;">
            <input id="filter_username" type="text" placeholder="代理商名称" style="width: 350px;">
            <i id="filter-nwagency-qrybtn" class="fa fa-search"></i>
        </form>
    </div>

    <div class="page-title tool-title" style="margin-top:10px;">        
        <a id="button-nwagency-create" href="javascript:void(0);"><i class="fa fa-plus"></i>新增代理商</a>
        <a id="button-nwagency-update" href="javascript:void(0);"><i class="fa fa-pencil-square-o"></i>修改代理商</a>
    </div>
    <div class="table-responsive">
        <table id="table-nwagency-sheet" class="table table-hover" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th></th>
                    <th>登录账号</th>
                    <th>代理商名称</th>                  
                    <th>账号余额</th>                  
                    <th>状 态</th>
                    <th>联系人</th>
                    <th>联系电话</th>
                    <th>联系QQ</th>
                    <th>联系微信</th>
                    <th>备注描述</th>
                    <th>创建时间</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>
<div id="dialog-nwagency-update" class="modal fade" tabindex="-1" data-width="1000" data-backdrop="static" data-keyboard="false" style="display: none;">
    <div class="modal-header"> 
        <button type="button" class="close" data-dismiss="modal" id="nwagencyclose" aria-hidden="true">×</button>
        <h4 id="dtitle-nwagency-update" class="modal-title">修改代理商</h4> 
    </div>
    <div class="modal-body" style="background: #fdf8e4">
        <form id="form-nwagency-update" class="m-t form-horizontal" role="form">            
            <input id="form_nwagencyid" name="nwagencyid" type="hidden">
            <ul class="list-group">
                <li class="list-group-item"><span class=" panel panel-primary">代理商信息</span>
                    <div class="form-group">
                        <div class="col-lg-6">
                            <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>代理商名称</label>
                            <div class="col-lg-8"><input id="nwagencyname" name="username" placeholder="代理商名称" class="form-control" maxlength="32"  required  data-error="代理商名称不能为空"><div class="help-block with-errors"></div></div>
                        </div>
                        <div class="col-lg-6">
                            <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>登录账号</label>
                            <div class="col-lg-8"><input id="nwaccount" name="account" placeholder="登录账号" class="form-control" maxlength="32"  required  data-error="代理商账号不能为空"><div class="help-block with-errors"></div></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-6">
                            <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>初始密码</label>
                            <div class="col-lg-8"><input id="nwpassword" name="password" placeholder="初始密码" class="form-control" maxlength="64"  required  data-error="初始密码不能为空"><div class="help-block with-errors"></div></div>
                        </div>
                        <div class="col-lg-6">
                            <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>状态</label>
                            <div class="col-lg-8">
                                <select id="selectCorpStatus" name="status" class="form-control">
                                    <option value="10">正常</option>
                                    <option value="20">待审批</option>
                                    <option value="40">冻结</option>
                                    <option value="50">隐藏</option>
                                    <option value="60">关闭</option>
                                    <option value="70">过期</option>
                                    <option value="80">删除</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-6">
                            <label class="col-lg-3 control-label">备注说明</label>
                            <div class="col-lg-8"><input name="remark" placeholder="备注说明" class="form-control"></div>
                        </div>
                        <div class="col-lg-6">
                            <label class="col-lg-3 control-label">所在地址</label>
                            <div class="col-lg-8"><input name="address" placeholder="所在地址" class="form-control"></div>
                        </div>
                    </div>
                </li>
            </ul>

            <ul class="list-group">
                <li class="list-group-item"><span class=" panel panel-info">代理商联系人信息</span>
                    <div class="form-group">
                        <div class="col-lg-6">
                            <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>联系人</label>
                            <div class="col-lg-8"><input name="linkman" placeholder="联系人" required  data-error="请输入正确的联系人" class="form-control"></div>
                        </div>
                        <div class="col-lg-6">
                            <label class="col-lg-3 control-label"><span style="color: red;">*&nbsp;</span>联系电话</label>
                            <div class="col-lg-8"><input name="linktel" type="tel" placeholder="联系电话" class="form-control" pattern="^\d{8,13}$" data-error="请输入正确的联系电话"><div class="help-block with-errors"></div></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-6">
                            <label class="col-lg-3 control-label">联系微信</label>
                            <div class="col-lg-8"><input name="linkwx" placeholder="联系微信" class="form-control"></div>
                        </div>
                        <div class="col-lg-6">
                            <label class="col-lg-3 control-label">联系QQ</label>
                            <div class="col-lg-8"><input name="linkqq" type="tel" placeholder="联系QQ" class="form-control" pattern="^[1-9]\d{4,12}$" data-error="请输入正确的QQ号码"><div class="help-block with-errors"></div></div>
                        </div>
                    </div>
                </li>
            </ul>
            <br>
            <button id="formbtn-nwagency-update" type="button" class="btn btn-theme btn-lg btn-block ">提 交</button><br>
        </form>
    </div>
    <div id="tips-nwagency-update" class="module-alert-tips"></div><br>
</div>
<script>
    {
        if (system_memberinfo && system_memberinfo.memberid) {
            var mtable = $('#table-nwagency-sheet').dataTable({
                ajax: {
                    url: "/pipes/network/nwagency/query",
                    data: function (f) {
                        f.bean = JSON.stringify({
                            username: $('#filter_username').val().trim()
                        });
                        f.sort = 'createtime';
                        f.order = 'DESC';
                    }
                },
                columnDefs: [{
                        className: 'select-checkbox',
                        targets: 0
                    }],
                columns: [
                    {"data": "", render: $.defrender},
                    {"data": "account", render: $.defrender},
                    {"data": "username", render: $.defrender},
                    {"data": "finance", render: function (value, type, full) {
                            return value ? ((value['money'] || 0) / 100.0).fmoney(2) : "";
                        }},
                    {"data": "status", render: defStatusRender},
                    {"data": "linkman", render: $.defrender},
                    {"data": "linktel", render: $.defrender},
                    {"data": "linkqq", render: $.defrender},
                    {"data": "linkwx", render: $.defrender},
                    {"data": "remark", render: $.defrender},
                    {"data": "createtime", render: Date.DateFormatter}
                ]
            });
            $('#filter-nwagency-qrybtn').bind("click", function () {
                mtable.api(true).draw(false);
                $('#table-nwagency-sheet').dataTable().fnPageChange(0);
            });
            //--------------------------- 初始化新增修改代理商 -----------------------------
            $('#button-nwagency-create').bind("click", function () {
                $('#form-gfield-password').show();
                $('#dtitle-nwagency-update').html("新增代理商");
                $("#tips-nwagency-update").html('');
                $("#form-nwagency-update").form('reset');
                $('#dialog-nwagency-update').modal('show');
                $("#nwaccount").removeAttr("readonly", "readonly");
                $("#nwpassword").removeAttr("readonly", "readonly");
                $("#nwpassword").val("");
                $("#form_nwagencyid").val("0");
                /*    $("#form-nwagency-update").data('bootstrapValidator').destroy();
                 $('#form-nwagency-update').data('bootstrapValidator', null);*/
                nwagencyValidator();
            });
            $('#button-nwagency-update').bind("click", function () {
                var data = mtable.api(true).row({selected: true}).data();
                if (!data || !data.nwagencyid) {
                    alert("请选择一条记录！");
                    return;
                }
                /*  $('#form-gfield-password').hide();*/
                $('#dtitle-nwagency-update').html("修改代理商");
                $("#tips-nwagency-update").html('');
                $("#form-nwagency-update").form('reset');
                $("#form-nwagency-update").form('load', data);
                $('#dialog-nwagency-update').modal('show');
                $("#nwaccount").attr("readonly", "readonly");
                $("#nwpassword").val("******");
                $("#nwpassword").attr("readonly", "readonly");
                nwagencyValidator();
            });
            //------------------------ 新增&修改代理商提交 -----------------------------
            $('#formbtn-nwagency-update').bind("click", function (e) {
                var form = $("#form-nwagency-update");
                var json = form.serializeJson();
                $('#form-nwagency-update').bootstrapValidator('validate');
                if ($('#form-nwagency-update').data('bootstrapValidator').isValid()) {
                    if (!json.nwagencyid || json.nwagencyid == '0') {
                        json.password = $.md5(json.password);
                    }
                    $.ajax({
                        cache: false,
                        dataType: "json",
                        type: "POST",
                        url: '/pipes/network/nwagency/update',
                        data: {
                            "bean": $.objectToString(json),
                            "columns": JSON.stringify(['username', 'linkman', 'linktel', 'linkqq', 'linkwx', 'status', 'address', 'remark'])
                        },
                        error: function () {//请求失败处理函数
                            alert('请求失败');
                        },
                        success: function (data) {
                            if (data && data.retcode && data.retcode > 0) {
                                alert(data.retinfo);
                            } else {
                                alert("保存成功");
                                $("#form-nwagency-update").data('bootstrapValidator').destroy();
                                $('#form-nwagency-update').data('bootstrapValidator', null);
                                $("#dialog-nwagency-update").modal('hide');
                                mtable.api(true).draw(false);
                            }
                        }
                    });
                } else {
                    alert("验证不通过,请按要求填写信息");
                }
            });
            //-----------------点击关闭摧毁验证---------------------------
            $("#nwagencyclose").on("click", function () {
                $("#form-nwagency-update").data('bootstrapValidator').destroy();
                $('#form-nwagency-update').data('bootstrapValidator', null);
            });
            //-----------------验证代理商表单方法------------------------------
            function nwagencyValidator() {
                $('#form-nwagency-update').bootstrapValidator({
                    message: 'This value is not valid',
                    feedbackIcons: {
                        /*输入框不同状态，显示图片的样式*/
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {
                        /*验证*/
                        username: {
                            /*键名和input name值对应*/
                            message: 'The username is not valid',
                            validators: {
                                notEmpty: {
                                    /*非空提示*/
                                    message: '代理商名称不能为空'
                                },
                                regexp: {
                                    /* 只需加此键值对 */
                                    regexp: /^[A-Za-z0-9\u4e00-\u9fa5]+$/,
                                    message: '代理商名称不能包含任何数字或者符号'
                                }
                            }
                        }
                    }
                });
            }

        }
    }
</script>
